import scipy
import numpy
cd larpy
from lar import *

def GRID(args):
	model = ([[]],[[0]])
	for k,steps in enumerate(args):
		model = larExtrude(model,steps*[1])
	V,cells = model
	verts = AA(list)(scipy.array(V)/AA(float)(args))
	return MKPOL([verts,AA(AA(lambda h:h+1))(cells),None])

dom1D = GRID([10])

dom2D = GRID([20,20])

#superficie di bezier con 2 curve 

def bs2(l):
	p1,p2 = l
	c1 = BEZIER(S1)(p1)
	c2 = BEZIER(S1)(p2)
	#VIEW(STRUCT([MAP(c1)(dom1D),MAP(c2)(dom1D),MAP(c3)(dom1D)]))
	return MAP(BEZIER(S2)([c1,c2]))(dom2D)

#superficie di bezier con 3 curve

def bs3(l):
	p1,p2,p3 = l
	c1 = BEZIER(S1)(p1)
	c2 = BEZIER(S1)(p2)
	c3 = BEZIER(S1)(p3)
	#VIEW(STRUCT([MAP(c1)(dom1D),MAP(c2)(dom1D),MAP(c3)(dom1D)]))
	return MAP(BEZIER(S2)([c1,c2,c3]))(dom2D)

#roof

pu00 = [[2.66, 4.96, -0.1], [2.61, 4.95, -0.5], [2.61, 4.95, -1.9], [2.66, 4.96, -2.4]]
pu000 = [[3.09, 5.05, -0.1],[3.09, 5.1, -0.5],[3.09, 5.1, -1.9],[3.09, 5.05, -2.4]]
pu02 = [[3.88, 4.96, -0.1],[3.88, 4.96, -0.5],[3.88, 4.96, -1.9],[3.88, 4.96, -2.4]]
roof = COLOR(GREEN)(bs3([pu02,pu000,pu00]))

#front hood

ph00 = [[0.25, 4.13, -1.25]]
pl100 = [[0.43, 4.13, -0.1], [0.62, 4.24, -0.1], [0.95, 4.5, -0.1], [1.56, 4.6, -0.1]]
fh00 = bs2([pl100, ph00])

pr100 = [[0.43, 4.13, -2.4], [0.62, 4.24, -2.4], [0.95, 4.5, -2.4], [1.56, 4.6, -2.4]]
fh01 = bs2([ph00, pr100])

ph01 = [[0.25, 4.13, -1.25],[1.56, 4.6, -0.1]]
ph02 = [[0.25, 4.13, -1.25],[1.56, 4.6, -2.4]]
ph03 = [[0.25, 4.13, -1.25],[0.62, 4.24, -1.25], [0.9, 4.5, -1.25], [1.1, 4.55, -1.25]]
fh02 = bs3([ph01,ph03,ph02])

pu04 = [[0.43, 4.13,-0.1],[0.25, 4.13,-1.25]]
pu05 = [[0.25, 4.13,-1.25],[0.43, 4.13,-2.4]]
frontdown1 = bs2([[[0.56, 3.96,-0.1],[0.36, 3.96,-1.25]],pu04])
frontdown2 = bs2([[[0.36, 3.96,-1.25],[0.56, 3.96, -2.4]],pu05])
pu14 = [[0.52, 3.83,-0.1],[0.32, 3.83,-1.25]]
pu15 = [[0.32, 3.83,-1.25],[0.52, 3.83, -2.4]]
frontdown3 = bs2([[[0.56, 3.96,-0.1],[0.36, 3.96,-1.25]],pu14])
frontdown4 = bs2([[[0.36, 3.96,-1.25],[0.56, 3.96, -2.4]],pu15])

front_hood = COLOR(GREEN)(STRUCT([fh00,fh01,fh02,frontdown1,frontdown2,frontdown3,frontdown4]))

#windshield

pu01 = [[1.57, 4.6, -0.1],[1.25, 4.55, -0.5], [1.25, 4.55, -1.9],[1.57, 4.6, -2.4]]
ws = COLOR(CYAN)(bs2([pu00,pu01]))

#back window

pbw00 = ([[5.61, 4.71, -0.7],[3.88, 4.92, -0.3]])
pbw01 = ([[5.61, 4.71, -1.7],[3.88, 4.92, -2.2]])

back_window = COLOR(CYAN)(bs2([pbw01,pbw00]))

#back hood

pu03 = [[3.88, 4.92, -0.1],[3.88, 4.92, -0.5],[3.88, 4.92, -1.9],[3.88, 4.92, -2.4]]
pu06 = [[5.54, 4.71, -0.1],[5.65, 4.71, -0.5],[5.65, 4.71, -1.9],[5.54, 4.71, -2.4]]

back_hood = COLOR(GREEN)(bs2([pu06,pu03]))

#back

pu09 = [[5.65, 4.19, 0],[5.75, 4.19, -0.5],[5.75, 4.19, -1.9],[5.65, 4.19, -2.5]]

back0 = bs2([pu09,pu06])
back1 = bs2([pu03,pu02])

pu07 = [[5.63, 3.97, 0],[5.75, 3.97, -0.5],[5.75, 3.97, -1.9],[5.63, 3.97, -2.5]]

back2 = bs2([pu07,[[5.49, 4, 0], [5.49, 4, -2.5]]])

pl02 = [[5.18, 3.78, 0], [5.33, 3.76, 0], [5.46, 3.83, 0], [5.63, 3.97, 0]]
pr02 = [[5.18, 3.78, -2.5], [5.33, 3.76, -2.5], [5.46, 3.83, -2.5], [5.63, 3.97, -2.5]]
back3 = bs2([pl02,pr02])

pu08 = [[5.52, 4.17, 0],[5.62, 4.17, -0.5],[5.62, 4.17, -1.9],[5.52, 4.17, -2.5]]
back4 = bs2([pu08,[[5.49, 4, 0], [5.49, 4, -2.5]]])
back5 = bs2([[[5.49, 4, 0], [5.49, 4, -2.5]],pu09])

back = COLOR(GREEN)(STRUCT([back0,back1,back2,back3,back4,back5]))

#logo

logo1 = T([1,2,3])([0.28, 4.16, -1.325])(R([1,3])(PI/2)(R([2,3])(-PI/3-PI/20)(TEXTURE('../workspace/418405/2013-05-10/images/image5.jpg')(CUBOID([0.15,0.15,0.01])))))

#left window
pl11 = [[1.9, 4.6, -0.1], [2.96, 5.23, -0.1], [4.39, 4.84, -0.1], [4.33, 4.72, -0.1]]
pl110 = [[1.9, 4.6, -0.1],[2.2, 4.45,-0.1], [3.53, 4.68,-0.1], [4.33, 4.72, -0.1]]

lw = COLOR(CYAN)(bs2([pl110,pl11]))

#right window

pr11 = [[1.9, 4.6, -2.4], [2.96, 5.23, -2.4], [4.39, 4.84, -2.4], [4.33, 4.72, -2.4]]
pr110 = [[1.9, 4.6, -2.4], [2.2, 4.45,-2.4], [3.53, 4.68,-2.4], [4.33, 4.72, -2.4]]

rw = COLOR(CYAN)(bs2([pr11,pr110]))

#leftside

pl04 = [[0.68, 4.14, 0], [1.06, 4.42, 0], [1.34, 4.68, 0], [2.22, 4.5, 0]]
pl10 = [[0.43, 4.13, -0.1], [0.62, 4.24, -0.1], [1.29, 4.7, -0.1], [1.9, 4.6, -0.1]]

ls0 = bs2([pl04,pl10])

pl05 = [[2.23, 4.46, 0], [3.97, 4.59, 0], [4.65, 4.78, 0], [5.36, 4.64, 0]]
pl050 = [[2.28, 4.55, -0.1], [3.4, 4.59, -0.1], [4, 4.78, -0.1], [5.54, 4.71, -0.1]]

ls1 = bs2([pl05,pl050])

ls = COLOR(GREEN)(STRUCT([ls0,ls1]))

#rightside

pr04 = [[0.68, 4.14, -2.5], [1.06, 4.42, -2.5], [1.34, 4.68, -2.5], [2.22, 4.5, -2.5]]
pr10 = [[0.43, 4.13, -2.4], [0.62, 4.24, -2.4], [1.29, 4.7, -2.4], [1.9, 4.6, -2.4]]

rs0 = bs2([pr04,pr10])

pr05 = [[2.23, 4.46, -2.5], [3.97, 4.59, -2.5], [4.65, 4.78, -2.5], [5.36, 4.64, -2.5]]
pr050 = [[2.28, 4.55, -2.4], [3.4, 4.59, -2.4], [4, 4.78, -2.4], [5.54, 4.71, -2.4]]

rs1 = bs2([pr05,pr050])

rs = COLOR(GREEN)(STRUCT([rs0,rs1]))

surface = STRUCT([roof,front_hood,ws,back_window,back_hood,logo1,back,lw,rw,ls,rs])

centered_surf = T([1,2,3])([-(SIZE([1])(surface)[0])/2-0.45,-(SIZE([2])(surface)[0])/2-3.78,(SIZE([3])(surface)[0])/2])(surface)

VIEW(STRUCT([centered_sk,centered_surf]))

mock = STRUCT([centered_sk,wheels,steering,centered_surf])

VIEW(mock)
